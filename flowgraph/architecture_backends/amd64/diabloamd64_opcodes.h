/*
 * Copyright 2001,2002: Bruno De Bus
 *                      Bjorn De Sutter
 *                      Dominique Chanet
 *                      Ludo Van Put
 *
 *
 * This file is part of Diablo (Diablo is a better link-time optimizer)
 *
 * Diablo is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * Diablo is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Diablo; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 *
 */

#ifndef AMD64_OPCODE_TYPEDEFS
#define AMD64_OPCODE_TYPEDEFS
typedef struct _t_amd64_opcode_info t_amd64_opcode_info;
typedef enum _t_amd64_opcode t_amd64_opcode;

enum _t_amd64_opcode {
  AMD64_LAST_OPC	= -124,
  AMD64_3DNOW_OPC       = -123,
  AMD64_GRP1a           = -122,
  AMD64_GRP1b           = -121,
  AMD64_GRP1c           = -120,
  AMD64_GRP1d           = -119,
  AMD64_GRP2a           = -118,
  AMD64_GRP2b           = -117,
  AMD64_GRP3a           = -116,
  AMD64_GRP3b           = -115,
  AMD64_GRP4a           = -114,
  AMD64_GRP4b           = -113,
  AMD64_GRP4c           = -112,
  AMD64_GRP4d           = -111,
  AMD64_GRP5a           = -110,
  AMD64_GRP5b           = -109,
  AMD64_GRP6a           = -108,
  AMD64_GRP6b           = -107,
  AMD64_GRP7a           = -106,
  AMD64_GRP7b           = -105,
  AMD64_GRP8a           = -104,
  AMD64_GRP12           = -103,
  AMD64_GRP13           = -102,
  AMD64_GRP14           = -101,
  AMD64_GRP15a          = -100,
  AMD64_GRP15a11        = -99,
  AMD64_GRP16           = -98,
  AMD64_PREFIX_GRP_1    = -97,
  AMD64_PREFIX_GRP_2    = -96,
  AMD64_PREFIX_GRP_3    = -95,
  AMD64_PREFIX_GRP_4    = -94,
  AMD64_PREFIX_GRP_5    = -93,
  AMD64_PREFIX_GRP_6    = -92,
  AMD64_PREFIX_GRP_7    = -91,
  AMD64_PREFIX_GRP_8    = -90,
  AMD64_PREFIX_GRP_9    = -89,
  AMD64_PREFIX_GRP_A    = -88,
  AMD64_PREFIX_GRP_B    = -87,
  AMD64_PREFIX_GRP_C    = -86,
  AMD64_PREFIX_GRP_D    = -85,
  AMD64_PREFIX_GRP_E    = -84,
  AMD64_PREFIX_GRP_F    = -83,
  AMD64_PREFIX_GRP_10   = -82,
  AMD64_PREFIX_GRP_11   = -81,
  AMD64_PREFIX_GRP_12   = -80,
  AMD64_PREFIX_GRP_13   = -79,
  AMD64_PREFIX_GRP_14   = -78,
  AMD64_PREFIX_GRP_15   = -77,
  AMD64_PREFIX_GRP_16   = -76,
  AMD64_PREFIX_GRP_17   = -75,
  AMD64_PREFIX_GRP_18   = -74,
  AMD64_PREFIX_GRP_19   = -73,
  AMD64_PREFIX_GRP_1A   = -72,
  AMD64_PREFIX_GRP_1B   = -71,
  AMD64_PREFIX_GRP_1C   = -70,
  AMD64_PREFIX_GRP_1D   = -69,
  AMD64_PREFIX_GRP_1E   = -68,
  AMD64_PREFIX_GRP_1F   = -67,
  AMD64_PREFIX_GRP_20   = -66,
  AMD64_PREFIX_GRP_21   = -65,
  AMD64_PREFIX_GRP_22   = -64,
  AMD64_PREFIX_GRP_23   = -63,
  AMD64_PREFIX_GRP_24   = -62,
  AMD64_PREFIX_GRP_25   = -61,
  AMD64_PREFIX_GRP_26   = -60,
  AMD64_PREFIX_GRP_27   = -59,
  AMD64_PREFIX_GRP_28   = -58,
  AMD64_PREFIX_GRP_29   = -57,
  AMD64_PREFIX_GRP_2A   = -56,
  AMD64_PREFIX_GRP_2B   = -55,
  AMD64_PREFIX_GRP_2C   = -54,
  AMD64_PREFIX_GRP_2D   = -53,
  AMD64_PREFIX_GRP_2E   = -52,
  AMD64_PREFIX_GRP_2F   = -51,
  AMD64_PREFIX_GRP_30   = -50,
  AMD64_PREFIX_GRP_31   = -49,
  AMD64_PREFIX_GRP_32   = -48,
  AMD64_PREFIX_GRP_33   = -47,
  AMD64_PREFIX_GRP_34   = -46,
  AMD64_PREFIX_GRP_35   = -45,
  AMD64_PREFIX_GRP_36   = -44,
  AMD64_PREFIX_GRP_37   = -43,
  AMD64_PREFIX_GRP_38   = -42,
  AMD64_PREFIX_GRP_39   = -41,
  AMD64_PREFIX_GRP_3A   = -40,
  AMD64_PREFIX_GRP_3B   = -39,
  AMD64_PREFIX_GRP_3C   = -38,
  AMD64_PREFIX_GRP_3D   = -37,
  AMD64_PREFIX_GRP_3E   = -36,
  AMD64_PREFIX_GRP_3F   = -35,
  AMD64_PREFIX_GRP_40   = -34,
  AMD64_PREFIX_GRP_41   = -33,
  AMD64_PREFIX_GRP_42   = -32,
  AMD64_PREFIX_GRP_43   = -31,
  AMD64_PREFIX_GRP_44   = -30,
  AMD64_PREFIX_GRP_45   = -29,
  AMD64_PREFIX_GRP_46   = -28,
  AMD64_PREFIX_GRP_47   = -27,
  AMD64_PREFIX_GRP_48   = -26,
  AMD64_PREFIX_GRP_49   = -25,
  AMD64_PREFIX_GRP_4A   = -24,
  AMD64_PREFIX_GRP_4B   = -23,
  AMD64_PREFIX_GRP_4C   = -22,
  AMD64_PREFIX_GRP_4D   = -21,
  AMD64_PREFIX_GRP_4E   = -20,
  AMD64_PREFIX_GRP_4F   = -19,
  AMD64_PREFIX_GRP_50   = -18,
  AMD64_PREFIX_GRP_51   = -17,
  AMD64_PREFIX_GRP_52   = -16,
  AMD64_PREFIX_GRP_53   = -15,
  AMD64_PREFIX_GRP_54   = -14,
  AMD64_PREFIX_GRP_55   = -13,
  AMD64_PREFIX_GRP_56   = -12,
  AMD64_PREFIX_GRP_57   = -11,
  AMD64_PREFIX_GRP_58   = -10,
  AMD64_PREFIX_GRP_59   = -9,
  AMD64_PREFIX_GRP_5A   = -8,
  AMD64_PREFIX_GRP_5B   = -7,
  AMD64_PREFIX_GRP_5C   = -6,
  AMD64_PREFIX_GRP_5D   = -5,
  AMD64_PREFIX_GRP_5E   = -4,
  AMD64_PREFIX_GRP_5F   = -3,
  AMD64_FPU_ESC         = -2,
  AMD64_TWOBYTE_ESC     = -1,
  AMD64_INVALID_OPC     =  0,
  AMD64_UNSUPPORTED_OPC =  1,
  AMD64_DATA, 
  AMD64_AAA,
  AMD64_AAD,
  AMD64_AAM,
  AMD64_AAS,
  AMD64_ADC,
  AMD64_ADD,
  AMD64_AND,
  AMD64_MOVSXD,
  AMD64_BOUND,
  AMD64_BSF,
  AMD64_BSR,
  AMD64_BSWAP,
  AMD64_BT,
  AMD64_BTC,
  AMD64_BTR,
  AMD64_BTS,
  AMD64_CALL,
  AMD64_CALLF,
  AMD64_CDQ,
  AMD64_CLC,
  AMD64_CLD,
  AMD64_CLI,
  AMD64_CLTS,
  AMD64_CMC,
  AMD64_CMOVcc,
  AMD64_CMP,
  AMD64_CMPSB,
  AMD64_CMPSD,
  AMD64_CMPXCHG,
  AMD64_CPUID,
  AMD64_CWDE,
  AMD64_DAA,
  AMD64_DAS,
  AMD64_DEC,
  AMD64_DIV,
  AMD64_ENTER,
  AMD64_F2XM1,
  AMD64_FABS,
  AMD64_FADD,
  AMD64_FADDP,
  AMD64_FBLD,
  AMD64_FBSTP,
  AMD64_FCHS,
  AMD64_FCLEX,
  AMD64_FCMOVcc,
  AMD64_FCOM,
  AMD64_FCOMI,
  AMD64_FCOMIP,
  AMD64_FCOMP,
  AMD64_FCOMPP,
  AMD64_FCOS,
  AMD64_FDECSTP,
  AMD64_FDIV,
  AMD64_FDIVP,
  AMD64_FDIVR,
  AMD64_FDIVRP,
  AMD64_FFREE,
  AMD64_FIADD,
  AMD64_FICOM,
  AMD64_FICOMP,
  AMD64_FIDIV,
  AMD64_FIDIVR,
  AMD64_FILD,
  AMD64_FIMUL,
  AMD64_FINCSTP,
  AMD64_FINIT,
  AMD64_FIST,
  AMD64_FISTP,
  AMD64_FISUB,
  AMD64_FISUBR,
  AMD64_FLD,
  AMD64_FLD1,
  AMD64_FLDCW,
  AMD64_FLDENV,
  AMD64_FLDL2E,
  AMD64_FLDL2T,
  AMD64_FLDLG2,
  AMD64_FLDLN2,
  AMD64_FLDPI,
  AMD64_FLDZ,
  AMD64_FMUL,
  AMD64_FMULP,
  AMD64_FNOP,
  AMD64_FPATAN,
  AMD64_FPREM,
  AMD64_FPREM1,
  AMD64_FPTAN,
  AMD64_FRNDINT,
  AMD64_FRSTOR,
  AMD64_FSAVE,
  AMD64_FSCALE,
  AMD64_FSIN,
  AMD64_FSINCOS,
  AMD64_FSQRT,
  AMD64_FST,
  AMD64_FSTCW,
  AMD64_FSTENV,
  AMD64_FSTP,
  AMD64_FSTSW,
  AMD64_FSUB,
  AMD64_FSUBP,
  AMD64_FSUBR,
  AMD64_FSUBRP,
  AMD64_FTST,
  AMD64_FUCOM,
  AMD64_FUCOMI,
  AMD64_FUCOMIP,
  AMD64_FUCOMP,
  AMD64_FUCOMPP,
  AMD64_FXAM,
  AMD64_FXCH,
  AMD64_FXRSTOR,
  AMD64_FXSAVE,
  AMD64_FXTRACT,
  AMD64_FYL2X,
  AMD64_FYL2XP1,
  AMD64_HLT,
  AMD64_IDIV,
  AMD64_IMUL,
  AMD64_IMULexp1,
  AMD64_IMULexp2,
  AMD64_IN,
  AMD64_INC,
  AMD64_INSB,
  AMD64_INSD,
  AMD64_INT,
  AMD64_INT3,
  AMD64_INTO,
  AMD64_INVD,
  AMD64_INVLPG,
  AMD64_IRET,
  AMD64_JRCXZ,
  AMD64_JMP,
  AMD64_JMPF,
  AMD64_Jcc,
  AMD64_LAHF,
  AMD64_LAR,
  AMD64_LDS,
  AMD64_LEA,
  AMD64_LEAVE,
  AMD64_LES,
  AMD64_LFS,
  AMD64_LGDT,
  AMD64_LGS,
  AMD64_LIDT,
  AMD64_LLDT,
  AMD64_LMSW,
  AMD64_LODSB,
  AMD64_LODSD,
  AMD64_LOOP,
  AMD64_LOOPNZ,
  AMD64_LOOPZ,
  AMD64_LSL,
  AMD64_LSS,
  AMD64_LTR,
  AMD64_MOV,
  AMD64_MOVNTI,
  AMD64_MOVSB,
  AMD64_MOVSD,
  AMD64_MOVSX,
  AMD64_MOVZX,
  AMD64_MUL,
  AMD64_NEG,
  AMD64_NOP,
  AMD64_NOT,
  AMD64_OR,
  AMD64_OUT,
  AMD64_OUTSB,
  AMD64_OUTSD,
  AMD64_POP,
  AMD64_POPA,
  AMD64_POPF,
  AMD64_PUSH,
  AMD64_PUSHA,
  AMD64_PUSHF,
  AMD64_RCL,
  AMD64_RCR,
  AMD64_RDMSR,
  AMD64_RDPMC,
  AMD64_RDTSC,
  AMD64_RET,
  AMD64_RETF,
  AMD64_ROL,
  AMD64_ROR,
  AMD64_RSM,
  AMD64_SAHF,
  AMD64_SAR,
  AMD64_SBB,
  AMD64_SCASB,
  AMD64_SCASD,
  AMD64_SETcc,
  AMD64_SGDT,
  AMD64_SHL,
  AMD64_SHLD,
  AMD64_SHR,
  AMD64_SHRD,
  AMD64_SIDT,
  AMD64_SLDT,
  AMD64_SMSW,
  AMD64_STC,
  AMD64_STD,
  AMD64_STI,
  AMD64_STOSB,
  AMD64_STOSD,
  AMD64_STR,
  AMD64_SUB,
  AMD64_SYSENTER,
  AMD64_SYSEXIT,
  AMD64_TEST,
  AMD64_UD2,
  AMD64_VERR,
  AMD64_VERW,
  AMD64_WAIT,
  AMD64_WBINVD,
  AMD64_WRMSR,
  AMD64_XADD,
  AMD64_XCHG,
  AMD64_XLAT,
  AMD64_XOR,

  AMD64_STMXCSR,
  AMD64_LDMXCSR,

  AMD64_MOVSD_SSE,  /* (SSE instruction) */
  AMD64_MOVSS,  /* (SSE instruction) */
  AMD64_MOVUPS,
  AMD64_MOVUPD,

  AMD64_CVTSI2SS,
  AMD64_CVTSI2SD,

  AMD64_CVTTSS2SI,
  AMD64_CVTTSD2SI,

  AMD64_COMISS,
  AMD64_COMISD,

  AMD64_UCOMISS,
  AMD64_UCOMISD,

  AMD64_XORPS,
  AMD64_XORPD,

  AMD64_PXOR,
  AMD64_PXORD,
  
  AMD64_CVTSD2SS,
  AMD64_CVTSD2SD,
  AMD64_CVTSD2PD,
  AMD64_CVTSD2PS,
  
  AMD64_MOVAPS,
  AMD64_MOVAPD,

  AMD64_EMMS,

  AMD64_MAXPS,
  AMD64_MAXSS,
  AMD64_MAXPD,
  AMD64_MAXSD,

  AMD64_DIVPS,
  AMD64_DIVSS,
  AMD64_DIVPD,
  AMD64_DIVSD,

  AMD64_CMPPS,
  AMD64_CMPSS,
  AMD64_CMPPD,
  AMD64_CMPSD_SSE,

  AMD64_ANDNPS,
  AMD64_ANDNPD,

  AMD64_ANDPS,
  AMD64_ANDPD,

  AMD64_ORPS,
  AMD64_ORPD,

  AMD64_MOVQ,
  AMD64_MOVDQA,
  AMD64_MOVDQU,
  AMD64_MOVD,
  AMD64_MOVD2,

  AMD64_MOVD3,
  AMD64_MOVD4,
  AMD64_MOVQ3,

  AMD64_PUNPCKHBW,
  AMD64_PUNPCKHBW2,

  AMD64_PUNPCKLBW,
  AMD64_PUNPCKLBW2,

  AMD64_PUNPCKLWD,
  AMD64_PUNPCKLWD2,

  AMD64_PUNPCKHWD,
  AMD64_PUNPCKHWD2,

  AMD64_PSHUFLW,
  AMD64_PSHUFHW,
  AMD64_PSHUFW,
  AMD64_PSHUFD,

  AMD64_PSUBW,
  AMD64_PSUBW2,

  AMD64_PMULLW,
  AMD64_PMULLW2,

  AMD64_PMULHW,
  AMD64_PMULHW2,

  AMD64_PSLLW,
  AMD64_PSLLW2,

  AMD64_PADDW,
  AMD64_PADDW2,

  AMD64_PADDSW,
  AMD64_PADDSW2,

  AMD64_PADDD,
  AMD64_PADDD2,

  AMD64_PADDB,
  AMD64_PADDB2,

  AMD64_PREFETCH_NTA,
  AMD64_PREFETCH_T0,
  AMD64_PREFETCH_T1,
  AMD64_PREFETCH_T2,

  AMD64_MOVNTQ,
  AMD64_MOVNTQD,

  AMD64_SFENCE,
  AMD64_LFENCE,
  AMD64_MFENCE,

  /* added for instrumentation code */
  AMD64_PSEUDOCALL,
  AMD64_PSEUDOSAVE,
  AMD64_PSEUDOLOAD,

  AMD64_PUNPCKLDQ,
  AMD64_PUNPCKLDQ2,

  AMD64_PUNPCKHDQ,
  AMD64_PUNPCKHDQ2,

  AMD64_PAND,
  AMD64_PAND2,

  AMD64_PMINUB,
  AMD64_PMINUB2,

  AMD64_PMAXUB,
  AMD64_PMAXUB2,

  AMD64_PANDN,
  AMD64_PANDN2,

  AMD64_PSRLQ,
  AMD64_PSRLQ2,

  AMD64_PSRLDQ,

  AMD64_PSLLQ,
  AMD64_PSLLQ2,

  AMD64_PSLLDQ,

  AMD64_POR,
  AMD64_POR2,

  AMD64_PMADDWD,
  AMD64_PMADDWD2,

  AMD64_PSRLD,
  AMD64_PSRLD2,

  AMD64_PSRLW,
  AMD64_PSRLW2,

  AMD64_PSRAW,
  AMD64_PSRAW2,

  AMD64_PSLLD,
  AMD64_PSLLD2,

  AMD64_PSRAD,
  AMD64_PSRAD2,

  AMD64_PCMPEQW,
  AMD64_PCMPEQW2,

  AMD64_PCMPEQB,
  AMD64_PCMPEQB2,

  AMD64_PACKUSWB,
  AMD64_PACKUSWB2,

  AMD64_PACKSSWB,
  AMD64_PACKSSWB2,

  AMD64_PACKSSDW,
  AMD64_PACKSSDW2,

  AMD64_PADDUSB,
  AMD64_PADDUSB2,

  AMD64_PADDUSW,
  AMD64_PADDUSW2,

  AMD64_PAVGB,
  AMD64_PAVGB2,

  AMD64_PAVGUSB,
  AMD64_PFADD,
  AMD64_PFMUL,
  AMD64_PI2FD,
  AMD64_PFACC,
  AMD64_PFSUB,
  AMD64_PFSUBR,
  AMD64_PF2ID,
  AMD64_PSWAPD,
  AMD64_PFPNACC,
  
  AMD64_MOVLPS, /* TODO: something strange in appendix */
  AMD64_MOVLPD,
  AMD64_MOVDDUP,
  AMD64_MOVSLDUP,
  
  AMD64_PSUBSW,
  AMD64_PSUBSW2,

  AMD64_PSUBD,
  AMD64_PSUBD2,

  AMD64_PSUBB,
  AMD64_PSUBB2,

  AMD64_PSHUFPS,
  AMD64_PSHUFPD,

  AMD64_ADDSD,
  AMD64_ADDSS,
  AMD64_ADDPS,
  AMD64_ADDPD,

  AMD64_MULSD,
  AMD64_MULSS,
  AMD64_MULPS,
  AMD64_MULPD,

  AMD64_SQRTSD,
  AMD64_SQRTSS,
  AMD64_SQRTPS,
  AMD64_SQRTPD,

  AMD64_SUBSD,
  AMD64_SUBSS,
  AMD64_SUBPS,
  AMD64_SUBPD,

  AMD64_MOVHPS, 
  AMD64_MOVHPD,
  AMD64_MOVSHDUP,

  AMD64_PSUBUSB,
  AMD64_PSUBUSB2,

  AMD64_PSUBUSW,
  AMD64_PSUBUSW2,
  AMD64_FFREEP,
  AMD64_SYSCALL,
  AMD64_SYSRET,
  AMD64_MOVDQ2Q,
  AMD64_UNPCKLPD,  
  AMD64_MINPD,
  AMD64_MINSD,
  AMD64_MINSS,  
  MAX_AMD64_OPCODE        /* always keep this entry last */
};
#endif

#ifndef AMD64_OPCODE_H
#define AMD64_OPCODE_H

#include <diabloamd64.h>

//typedef t_uint32 (*Amd64DisassembleFunction) (void *i, t_uint8* codep, t_uint32 modrm, t_uint32 sib);

struct _t_amd64_opcode_info {
  t_string textual;
  int type;
  /* condition flags used by this instruction */
  t_regset cf_used;
  /* condition flags defined by this instruction */
  t_regset cf_defined;
  int fpstack_pops;
  int fpstack_pushes;
  t_uint32 fixedops;
};

extern t_amd64_opcode_info amd64_opcode_table[];
void Amd64InitOpcodeTable(void);

#endif
